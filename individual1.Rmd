---
title: "individual1"
author: "cyber-atlas"
date: "April 11, 2019"
output: html_document
---

```{r}
# library('ggplot2')
# library('dplyr')
library('tidyverse')
library('maps')

acc<- read.csv('accident.csv', stringsAsFactors = FALSE)
# acc <- read.csv("https://raw.githubusercontent.com/xdaiISU/ds202materials/master/hwlabs/fars2017/accident.csv", stringsAsFactors = FALSE)
# person <- read.csv("https://raw.githubusercontent.com/xdaiISU/ds202materials/master/hwlabs/fars2017/person.csv")
person <- read.csv('person.csv', stringsAsFactors = FALSE)
 
# names(acc)
# person$PER_TYP
# names(person)

```

Assuming the first day of the week is Sunday in this case


```{r}

class(acc$DAY_WEEK)

acc$DAY_WEEK <- factor(acc[,'DAY_WEEK'])
levels(acc$DAY_WEEK) <- list("Sunday" = 1, 'Monday'=2, 'Tuesday'=3, 'Wednesday'=4, 'Thursday'=5, 'Friday'=6, 'Saturday'=7)

levels(acc$DAY_WEEK)

ggplot(data=acc, aes(x=DAY_WEEK, color= DAY_WEEK, fill=stat(count)))+
  geom_bar()+
  #geom_bar(aes(y=stat(count)))+
  geom_text(stat='count', aes(label=..count..), vjust = -.5)+
  scale_y_continuous(limits=c(0,6500))+
  theme(axis.text.x = element_text(angle =45, hjust=1))


```

What time of day do accidents most commonly occur

```{r}
class(acc$HOUR)

acc$HOUR<- factor(acc[,'HOUR'])

levels(acc$HOUR)[levels(acc$HOUR) == 99] <- "unknown"

levels(acc$HOUR)

ggplot(data=acc, aes(x=HOUR, fill= stat(count)))+
         #fill=stat(count)))+
  geom_bar()+
  #geom_bar(aes(y=stat(count)))+
  geom_text(stat='count', aes(label=..count..), angle=90,hjust = -.5)+
  scale_y_continuous(limits=c(0,2500))+
  theme(axis.text.x = element_text(angle =75, hjust=1))

```

```{r}

class(acc$DRUNK_DR)

acc$DRUNK_DR<- factor(acc[,'DRUNK_DR'])

#levels(acc$DAY_WEEK) <- list("Sunday" = 1, 'Monday'=2, 'Tuesday'=3, 'Wednesday'=4, 'Thursday'=5, 'Friday'=6, 'Saturday'=7)

levels(acc$'DRUNK_DR')

ggplot(data=acc, aes(x=DRUNK_DR, color=DRUNK_DR))+
         #fill=stat(count)))+
  geom_bar()+
 # geom_bar(aes(y=frequency(DRUNK_DR)))+
  geom_text(stat='count', aes(label=..count..), angle=0,vjust = -.1)
  #scale_y_continuous(limits=c(0,3000))
  #theme(axis.text.x = element_text(angle =75, hjust=1))
  #facet_wrap(~DRUNK_DR)


```

Part 2

Identify the drivers

** TODO skipping over this, not sure which variables to join the tables on **

```{r}
# TODO finsih
#Drivers are person type 1, so only select those
drivers <- person %>% filter(PER_TYP == 1)

driversAccByCase <- inner_join(drivers, acc, by = "ST_CASE")

head(driversAccByCase)


ggplot(driversAccByCase, aes(x=factor(HOUR.y), fill=factor(SEX)))+
  geom_bar()+
  facet_wrap(~DAY_WEEK)+
  theme(axis.text.x = element_text(angle =75, hjust=1))

```


Plot choropleth map of accidents ona county level
```{r}
#Import the frpp data telling us state code info
frpp <- readxl::read_xlsx('FRPP GLC United States.xlsx')
#copy acc in case we need it again
acc2 <- acc
#Rename the state to State Code so we can do a merge
#names(acc2)[names(acc2) == "STATE"] <- "State Code"
names(acc2)[names(acc2) == "COUNTY"] <- "County Code"
head(acc2)
#TODO
#acc2$"State Code"<- factor(acc2[,'State Code'])
acc2$"County Code"<- factor(acc2[,'County Code'])
#Need to save as a df first I guess
frpp<-data.frame(frpp)
class(frpp)
colnames(frpp) <- frpp[1,]
frpp <- frpp[-1,]
head(frpp)
#frpp$"State Code"<- factor(frpp[,'State Code'])
frpp$"County Code"<- factor(frpp[,'County Code'])
#frpp[,3]<- factor(frpp[,3])

#inner_join(acc2,frpp, by= "State Code" )
countyCodeDF<- inner_join(acc2,frpp, by= "County Code" )
head(countyCodeDF)

countyPlottingInfo <- map_data("county")

countyCodeDF <- countyCodeDF %>% mutate('County Name' = tolower('County Name'))

head(countyCodeDF)

countyCodeDF <- countyCodeDF %>% group_by('County Name') %>%  summarize(n=n())

```




