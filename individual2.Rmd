---
title: "Lab_5"
author: "Sam Shifflett"
date: "4/15/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
acc <- read.csv("https://raw.githubusercontent.com/xdaiISU/ds202materials/master/hwlabs/fars2017/accident.csv", stringsAsFactors = FALSE)
names(acc)
```

Part One:
```{r}
library(ggplot2)
ggplot(acc,aes(x=factor(DAY_WEEK),fill=factor(DAY_WEEK))) + geom_bar(stat_count='identity') + ylab('Number of Crashes') + xlab("Day of the Week") + scale_x_discrete(breaks=c(1,2,3,4,5,6,7),labels=c("Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday")) + ggtitle("Number of Crashes Each Day")
```

```{r}
ggplot(acc,aes(x=factor(HOUR),fill=factor(HOUR))) + geom_bar(stat_count='identity') + ylab('Number of Crashes Per Hour') + xlab("Hour of Day") + ggtitle("Number of Crashes Each Hour")
```


```{r}
ggplot(acc,aes(x=factor(DRUNK_DR),fill=factor(DRUNK_DR))) + geom_bar(stat_count='identity') + ylab('Number of Crashes') + xlab("Number of Drunk Drivers") + ggtitle("Number of Crashes With Drunk Drivers")
```

Person Type 1 is the Driver of the vehicle
County appears in the PERSON and ACCIDENT will innerjoin with this
```{r}
library(tidyverse)
person <- read.csv("https://raw.githubusercontent.com/xdaiISU/ds202materials/master/hwlabs/fars2017/person.csv", stringsAsFactors = FALSE)
filperson = filter(person, PER_TYP==1)
joined = inner_join(filperson, acc, by = "ST_CASE", type = "inner", match = "all")
head(joined)
```

```{r}
joined = filter(joined, joined$HOUR.x < 25)
joined = filter(joined, joined$SEX < 3)
joined$DAY_WEEK = factor(joined$DAY_WEEK,labels=c("Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"))
ggplot(joined,aes(x=HOUR.x,fill=factor(SEX))) + geom_bar(position="dodge") + facet_wrap(joined$DAY_WEEK) + xlab("Hour of the Day") + ylab("Number of Crashes") + ggtitle("Number of Crashes Each Day of the Week by Hour and Sex") + guides(fill=guide_legend("SEX")) + scale_fill_discrete(name = "SEX", labels = c("Male","Female"))
```


```{r}
library(tidyverse)
GLC = readxl::read_xlsx("/Users/samuelshifflett/Documents/DS202/DS202_Github/ds202_lab5/ds202_lab5/GLC.xlsx")
colnames(GLC) = GLC[1, ] 
GLC = GLC[-1, ]
names(GLC)
counties = map_data("county")
names(GLC)[6] = "COUNTY"
names(GLC)[7] = "County_Name"
names(GLC)
GLC$COUNTY = factor(GLC$COUNTY)
acc$COUNTY = factor(acc$COUNTY)
names(counties)[6] = "County_Name"
names(counties)
countacc = inner_join(acc,GLC, by="COUNTY") %>% select(LATITUDE,LONGITUD,COUNTY,"County_Name",DAY,MONTH,YEAR,HOUR,"State Name")
countacc = countacc %>% mutate(County_Name = tolower(County_Name))
countaccgroup = countacc %>% group_by(County_Name) %>% summarise(total_crashes = n())
countaccgroup = left_join(countaccgroup,counties, by="County_Name")
countaccgroup %>% group_by("County_Name") %>% ggplot(aes(x = long, y = lat,fill=total_crashes)) +
  geom_polygon(aes(group=group))
```
